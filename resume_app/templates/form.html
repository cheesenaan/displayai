{% extends 'index.html' %}
{% block content %}
{% load static %}
<br><br><br><br><br><br><br>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>


<header id="header" class="fixed-top d-flex align-items-center">
    <div class="container d-flex justify-content-between">

        <div class="logo">
            <h1><a href="/">display.ai</a></h1>
        </div>

        <nav id="navbar-form" class="navbar">
            <ul>
                <li><a class="nav-link scrollto active" href="/">Home</a></li>
                <li><a class="nav-link scrollto active" href="/">Demo</a></li>
                <li><a class="nav-link scrollto active" href="{% url 'account' account_id=account.id %}">Account details</a></li>
                <li><a class="nav-link scrollto active" href="{% url 'subscriptions' account_id=account.id %}"> Subscriptions </a></li>
                <li><a class="nav-link scrollto active" href="{% url 'logout' account_id=account.id %}"> Log Out </a></li>

            </ul>
            <i class="bi bi-list mobile-nav-toggle"></i>
        </nav>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
        // Mobile navigation toggle
        document.addEventListener('click', function (e) {
            if (e.target.classList.contains('mobile-nav-toggle')) {
                document.querySelector('#navbar-form').classList.toggle('navbar-mobile');
                e.target.classList.toggle('bi-list');
                e.target.classList.toggle('bi-x');
            }
        });

        // Mobile nav dropdowns activate
        document.addEventListener('click', function (e) {
            var navbar = document.querySelector('#navbar-form');
            if (navbar.classList.contains('navbar-mobile')) {
                var dropdownLink = e.target.closest('.navbar .dropdown > a');
                if (dropdownLink) {
                    e.preventDefault();
                    dropdownLink.nextElementSibling.classList.toggle('dropdown-active');
                }
            }
        }, true);
    });


    </script>

</header>


<style>

    #dataForm table {
        width: 100%;
        border-collapse: none;
    }

    #dataForm td {
        padding: 10px;
        border: 0px;
    }

    #dataForm .form-row td {
        text-align: left;
    }

    #dataForm td:first-child,
    #dataForm td:nth-child(2) {
        width: 10px; /* Set equal width for both columns */
    }

    #dataForm input, #dataForm select {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
        margin-bottom: 5px;
    }

    #dataForm br {
        clear: both;
    }



    body {
        font-family: 'Arial', sans-serif;
        background-color: #f4f4f4;
        color: #333;
        margin: 0;
        padding: 0;
        background-image: url('{% static "img/0 copy.jpg" %}');
                        background-size: cover;
                        background-position: center;
    }

    form {
        max-width: 800px;
        margin: 0 auto;
        background-color: #fff;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        /* background-color: rgba(255, 255, 255, 0.8); */

    }

    h1, h3 {
        color: black;
        font-weight: bold;  /* Add bold font for consistency */
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }

    th, td {
        border: 1px solid #ddd;
        padding: 12px;
        text-align: left;
        font-weight: bold;  /* Add bold font for consistency */
    }

    /* th {
        background-color: #3498db;
        color: #fff;
    } */

    #work_form, #projects_form {
        margin-bottom: 20px;
    }

    button {
        background-color: #3498db;
        color: #fff;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 10px; /* Add margin to the top of the buttons */
        font-weight: bold;  /* Add bold font for consistency */
    }

    button:hover {
        background-color: #2a80b9;
    }

    #add-work-form, #add-project-form {
        display: block;
        margin-bottom: 10px;
        background-color: #2ecc71;
        padding: 10px; /* Add padding to the buttons for better visibility */
        font-weight: bold;  /* Add bold font for consistency */
    }

    #add-work-form:hover, #add-project-form:hover {
        background-color: #29b765;
    }

    input, textarea {
        width: 100%;
        padding: 10px; /* Adjust padding for better appearance */
        box-sizing: border-box;
        margin-bottom: 10px; /* Add margin to the bottom of the input fields */
    }

    .form-container input,
    .form-container select,
    .form-container textarea {
        width: 100%; /* Make the form fields take the full width of the column */
        box-sizing: border-box;
        margin-bottom: 10px;
        padding: 10px;
    }

    #work_experience_question, #project_experience_question {
    text-align: center;
    font-size: 18px;
    margin-bottom: 20px;
    }

    #work_experience_options, #project_experience_options {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #work_experience_options, #project_experience_options label {
        margin: 0 10px;
        font-size: 16px;
    }

    #work_experience_options, #project_experience_options input {
        margin-right: 5px;
    }

    .beginning {
         margin: 10% auto;
        background-color: rgba(255, 255, 255, 0.8); /* Semi-transparent white background */
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        max-width: 650px; /* Limit the maximum width for better readability */

        }


</style>

        <div class = "beginning">

            <h1>Welcome {{account.name}}</h1>


            <!-- <p> you are on the {{account.tier}} version </p> -->
            <p> <b> {{remaining}}</b> more resume(s) and personal website(s) on  <b>{{ account.tier }} </b> version </p>

            {% if account.user_profile is None %}
                <p> No user profile found, please fill in below form </p>
            {% else %}
            <p>  Existing user profile found & loaded to save time </p>
            <p id="user_profile_question"> <b> Do you want to update user profile ? </b></p>
            <div id="user_profile_question">
                <label>
                    <input type="radio" name="user_profile_question" id="yes_user_profile_question" value="yes" onclick="toggle_form()"> Yes
                </label>
                <label>
                    <input type="radio" name="user_profile_question" id="no_user_profile_question" value="no" onclick="toggle_form()" checked> No
                </label>
            </div>

            <br> <br>  <br>  <br> 
            
            <a href="{% url 'confirmation' account_id=account.id %}" class="confirmation-button" id="user_profile_question_button">
                <button type="button">NO UPDATE TO USER PROFILE</button>
            </a>

            {% endif %}


        </div>
        

        {% if remaining < 0 %}
            <span style="color: red; font-weight: bold;">
                {{ account.tier }} version limit reached, <a href="http://127.0.0.1:8000/{{ account.id }}/confirmation">Upgrade Now</a>
            </span> <br>
            <script>
                // Wait for 10 seconds
                setTimeout(function() {
                    alert("{{ account.tier }} version limit reached. Click OK to view pricing and upgrade ");
                    window.location.href = "http://127.0.0.1:8000/{{ account.id }}/confirmation";
                }, 500); // 10000 milliseconds = 10 seconds
            </script>
        {% endif %}


<form method="post" enctype="multipart/form-data" id="userProfileForm">

    {% if account.user_profile is not None %}
        <script>
            // Initially hide the form since "No" is checked by default
            var form = document.getElementById('userProfileForm');
            form.style.display = 'none';
        
            function toggle_form() {
                var form = document.getElementById('userProfileForm');
                var yes_user_profile_question = document.getElementById('yes_user_profile_question');
                form.style.display = yes_user_profile_question.checked ? 'block' : 'none';

                var update_form = document.getElementById('user_profile_question_button');
                update_form.style.display = no_user_profile_question.checked ? 'block' : 'none';
            }
        </script>
    {% endif %}

    <!-- personal form -->
    <div>
        <div id="dataForm" method="post">
            {% csrf_token %}
            {% for field in form %}
                <label for="{{ field.id_for_label }}">
                    {{ field.label }}
                    {% if field.name in required_fields %}
                        *
                    {% endif %}
                </label>
                {{ field }}
            {% endfor %}
        </div>
        <br>
    </div>
    

    <b><p style="color:red;">We recommend a total of 10 work experiences and projects</p></b>

    <!-- work experince form -->
    <div>

        <script>
            function toggleWorkExperienceForm() {
                var workForm = document.getElementById('work_form');
                var yesRadio = document.getElementById('yesRadio');
                var addWorkFormButton = document.getElementById('add-work-form');

                workForm.style.display = yesRadio.checked ? 'block' : 'none';
                addWorkFormButton.style.display = yesRadio.checked ? 'block' : 'none';
            }
        </script>

        <h3>Work Experiences</h3>

        <script>
            const myGlobalFunctions = {};
            let totalformNumberAdderHelper = 0;

            window.addEventListener('load', function() {
                let workForm = document.querySelector("#work_form");
                let addButton = document.querySelector("#add-work-form");
                let totalformNumber = workForm.children.length;
                let totalformNumberAdder = totalformNumber;
                totalformNumberAdderHelper = totalformNumber;
                let totalFormsField = document.querySelector("input[name='work_experiences-TOTAL_FORMS']");

                addButton.addEventListener('click', addForm);

                function addForm() {

                    console.log("Add button clicked!");

                    let formNum = workForm.children.length; // Get the current number of forms

                    let newForm = `
                        <div id="work_experiences_container-${totalformNumberAdder}">
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Company Name</th>
                                        <th>Job Title</th>
                                    </tr>
                                    <tr class="form-row">
                                        <td><input type="text" name="work_experiences-${totalformNumberAdder}-company_name"></td>
                                        <td><input type="text" name="work_experiences-${totalformNumberAdder}-job_title"></td>
                                    </tr>
                                    <tr class="form-row">
                                        <td>Start Date</td>
                                        <td>End Date</td>
                                    </tr>
                                    <tr class="form-row">
                                        <td>Start Date <input type="date" name="work_experiences-${totalformNumberAdder}-start_date"></td>
                                        <td>End Date <input type="date" name="work_experiences-${totalformNumberAdder}-end_date"></td>



                                    </tr>
                                    <tr class="form-row">
                                        <td>City</td>
                                        <td>State</td>
                                    </tr>
                                    <tr class="form-row">
                                        <td><input type="text" name="work_experiences-${totalformNumberAdder}-city"></td>
                                        <td><input type="text" maxlength="2" name="work_experiences-${totalformNumberAdder}-state"></td>
                                    </tr>


                                    <tr class="form-row">
                                        <td colspan="2">
                                            <b style="color: palevioletred;"> 
                                                Description of your work in simple English. What did you do? What technologies/skills did you use?
                                                What was the numerical impact/benefit? The more info you give, the better your resume will be.
                                                <a href="https://www.google.com" style="color: lightskyblue;" target="_blank"> Examples</a>
                                            </b>
                                        </td>
                                    </tr>



                                    <tr class="form-row">
                                        <td colspan="2"><textarea name="work_experiences-${totalformNumberAdder}-description"></textarea></td>
                                    </tr>
                                </tbody>
                            </table>
                            <button id="delete-work-form-${totalformNumberAdder}" type="button"">Delete Work Experience</button>
                        </div>
                    `;



                    let container = document.createElement('div');
                    container.innerHTML = newForm;

                    workForm.appendChild(container);

                    // Add delete button for the newly added form
                    let deleteButton = document.querySelector(`#delete-work-form-${totalformNumberAdder}`);

                    deleteButton.addEventListener('click', function() {
                        deleteForm(container, formNum);
                    });
                    container.appendChild(deleteButton);

                    formNum++;
                    totalformNumber++;
                    totalformNumberAdder++;
                    totalFormsField.value = formNum;
                    totalformNumberAdderHelper = totalFormsField.value;
                    console.log(`formNum after add: ${formNum}`);
                    console.log(`Form added. Total forms: ${totalFormsField.value}`);
                }


                function deleteForm(form, formNum) {
                    let totalFormsField = document.querySelector("input[name='work_experiences-TOTAL_FORMS']");
                    console.log(`before deleting, totalFormsField value is: ${totalFormsField.value}`);
                    console.log(`this form is being deleted: ${formNum}`);
                    console.log(`workForm.children.length: ${workForm.children.length}`);

                    if (totalformNumberAdderHelper == 1) {
                        // If deleting the first form, just hide the work_form and set hasWorkExperience to 'no'
                        console.log("there is only 1 form so the radio button should become closed");
                        workForm.style.display = 'none';
                        addButton.style.display = 'none';
                        yesRadio.checked = false;
                        document.getElementById('noRadio').checked = true;
                    } else {
                        form.remove();
                        totalformNumberAdderHelper--;
                        console.log(`after deleting, there are this number of forms: ${totalFormsField.value}`);
                    }
                }

                let deleteButtons = document.querySelectorAll("[id^='delete-work-form-']");
                deleteButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        let formNum = parseInt(button.id.split('-').pop());
                        console.log("work form number " + formNum + " is being deleted");
                        deleteForm(workForm.children[formNum], formNum);
                    });
                });

                myGlobalFunctions.addForm = addForm;
                myGlobalFunctions.deleteForm = deleteForm;

            });
        </script>
        

        <p id="work_experience_question">Do you have relevant work experience?</p>
        <div id="work_experience_options">
            <label>
                <input type="radio" name="hasWorkExperience" id="yesRadio" value="yes" onclick="toggleWorkExperienceForm()"> Yes
            </label>
            <label>
                <input type="radio" name="hasWorkExperience" id="noRadio" value="no" onclick="toggleWorkExperienceForm()" checked> No
            </label>
        </div>

        <br> <br> <br>

        {% csrf_token %}
        {{ work_experience_formset.management_form }}
        <div id="work_form" style="display: none;">
            <div id="work_experiences_container-0">
                <table>
                    <tbody>
                        <tr>
                            <th>Company Name</th>
                            <th>Job Title</th>
                        </tr>
                        {% for work_form in work_experience_formset %}
                            <tr class="form-row">
                                <td>{{ work_form.company_name }}</td>
                                <td>{{ work_form.job_title }}</td>
                            </tr>
                            <tr class="form-row">
                                <td>Start Date</td>
                                <td>End Date</td>
                            </tr>
                            <tr class="form-row">
                                <td>{{ work_form.start_date }}</td>
                                <td>{{ work_form.end_date }}</td>
                            </tr>
                            <tr class="form-row">
                                <td>City</td>
                                <td>State</td>
                            </tr>
                            <tr class="form-row">
                                <td>{{ work_form.city }}</td>
                                <td>{{ work_form.state }}</td>
                            </tr>
                            <tr class="form-row">
                                <td colspan="2">
                                    <b style="color: palevioletred;"> 
                                        Description of your work in simple English. What did you do? What technologies/skills did you use?
                                        What was the numerical impact/benefit? The more info you give, the better your resume will be.
                                        <a href="https://www.google.com" style="color: lightskyblue;" target="_blank"> Examples</a>
                                    </b>
                                </td>
                            </tr>
                            <tr class="form-row">
                                <td colspan="2">{{ work_form.description }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <button id="delete-work-form-0" type="button"">Delete Work Experience</button>
            </div>
        </div>
        <button id="add-work-form" type="button" style="display: none;">Add Another Work Experience</button>


            {% if  account.user_profile.work_experiences.exists %}

                <script>
                    var number_of_work_experiences = "{{account.user_profile.work_experiences.count}}"

                    if (number_of_work_experiences > 0) {
                        var workForm = document.getElementById('work_form');
                        var yesRadio = document.getElementById('yesRadio');
                        var addWorkFormButton = document.getElementById('add-work-form');
                        yesRadio.checked = true;
                        workForm.style.display = yesRadio.checked ? 'block' : 'none';
                        addWorkFormButton.style.display = yesRadio.checked ? 'block' : 'none';
                    }

                    console.log(number_of_work_experiences)
                    window.addEventListener('load', function() {
                        for (let i = 1; i < number_of_work_experiences; i++) {
                            // console.log("adding previous work experience number ", i)
                            // console.log("workForm.children.length is" , workForm.children.length)
                            myGlobalFunctions.addForm();
                        }

                        var workForm = document.getElementById('work_form');
                        console.log(workForm.children.length)

                    });
                </script>


                {% for work_experience in account.user_profile.work_experiences.all %}
                <script>
                    window.addEventListener('load', function() {
                        var workForm = document.getElementById('work_form');
                        

                        {% with work_counter_index=forloop.counter0 %}
                        var newFormInstance = `
                            <div id="work_experiences_container-{{work_counter_index}}">
                                <table>
                                    <tbody>
                                        <tr>
                                            <th>Company Name</th>
                                            <th>Job Title</th>
                                        </tr>
                                        <tr class="form-row">
                                            <td><input type="text" name="work_experiences-{{work_counter_index}}-company_name" value="{{work_experience.company_name}}"></td>
                                            <td><input type="text" name="work_experiences-{{work_counter_index}}-job_title" value="{{work_experience.job_title}}"></td>
                                        </tr>
                                        <tr class="form-row">
                                            <td>Start Date</td>
                                            <td>End Date</td>
                                        </tr>
                                        <tr class="form-row">
                                            <td>Start Date <input type="date" name="work_experiences-{{work_counter_index}}-start_date" value="{{ work_experience.start_date|date:'Y-m-d' }}"></td>
                                            <td>End Date <input type="date" name="work_experiences-{{work_counter_index}}-end_date" value="{{ work_experience.end_date|date:'Y-m-d' }}"></td>
                                        </tr>

                                        <tr class="form-row">
                                            <td>City</td>
                                            <td>State</td>
                                        </tr>
                                        <tr class="form-row">
                                            <td><input type="text" name="work_experiences-{{work_counter_index}}-city" value="{{work_experience.city}}"></td>
                                            <td><input type="text" maxlength="2" name="work_experiences-{{work_counter_index}}-state" value="{{work_experience.state}}"></td>
                                        </tr>
                                        <tr class="form-row">
                                            <td colspan="2">
                                                <b style="color: palevioletred;"> 
                                                    Description of your work in simple English. What did you do? What technologies/skills did you use?
                                                    What was the numerical impact/benefit? The more info you give, the better your resume will be.
                                                    <a href="https://www.google.com" style="color: lightskyblue;" target="_blank"> Examples</a>
                                                </b>
                                            </td>
                                        </tr>
                                        <tr class="form-row">
                                            <td colspan="2"><textarea name="work_experiences-{{work_counter_index}}-description">{{work_experience.bullet1}}{{work_experience.bullet2}}{{work_experience.bullet3}}</textarea></td>
                                        </tr>
                                    </tbody>
                                </table>
                                <button id="delete-prev-work-form-{{work_counter_index}}" type="button" "="">Delete Work Experience</button>
                            </div>
                        `;

                        {% endwith %}

                        workForm.children[{{ forloop.counter0 }}].innerHTML = newFormInstance;
                        // console.log(workForm.children[{{ forloop.counter0 }}].innerHTML)
                    });
                </script>
                {% endfor %}

                <script>
                    window.addEventListener('load', function() {
                        var workForm = document.getElementById('work_form'); 
                        
                
                        if (workForm) {
                            workForm.addEventListener('click', function(event) {
                
                                // Check if the clicked element is a delete button
                                if (event.target.id.startsWith('delete-prev-work-form-')) {
                                    // Extract the index from the button id
                                    var index = parseInt(event.target.id.split('-').pop());
                
                                    // Check if the index is valid
                                    if (!isNaN(index)) {
                                        // Get the corresponding div with id "work_experiences_container-[index]"
                                        var containerId = 'work_experiences_container-' + index;
                                        var containerToRemove = document.getElementById(containerId);

                                        var containers = document.querySelectorAll('[id^="' + containerId + '"]');
                
                                        // Check if the container element exists
                                        if (containerToRemove) {
                                            if (totalformNumberAdderHelper == 1) {
                                                console.log("there is only 1 form so the radio button should become closed");
                                                workForm.style.display = 'none';
                                                yesRadio.checked = false;
                                                document.getElementById('noRadio').checked = true;

                                            } else {
                                                console.log("deleting workform container number" , index, containerId)
                                                console.log(containerToRemove)
                                                containerToRemove.remove();
                                                totalformNumberAdderHelper--;
                                                console.log("workForm.children.length" , workForm.children.length)
                                            }
                                            
                                        } else {
                                            console.error('Container element does not exist.', containerId);
                                        }
                                    } else {
                                        console.error('Invalid index or child element does not exist.', index);
                                    }
                                }
                            });
                        } else {
                            console.error('workForm is not defined.');
                        }
                    });
                </script>
            
            {% endif %}
            

    </div>


    <!-- project form -->
    <div>
        <!-- projects form -->
        <h3>Projects</h3>
        <b><p style="color:red;">Need help with projects ? Click here </p></b>


        <script>
            function toggleProjectExperienceForm() {
                    var projectForm = document.getElementById('projects_form');
                    var yesRadioProject = document.getElementById('yesProjectRadio');
                    var addProjectFormButton = document.getElementById('add-project-form');

                    projectForm.style.display = yesRadioProject.checked ? 'block' : 'none';
                    addProjectFormButton.style.display = yesRadioProject.checked ? 'block' : 'none';
                }
        </script>

        <p id="project_experience_question">Do you have project experience?</p>
        <div id="project_experience_options">
            <label>
                <input type="radio" name="hasProjectExperience" id="yesProjectRadio" value="yes" onclick="toggleProjectExperienceForm()"> Yes
            </label>
            <label>
                <input type="radio" name="hasProjectExperience" id="noProjectRadio" value="no" onclick="toggleProjectExperienceForm()" checked> No
            </label>
        </div>

        {% csrf_token %}
        {{ projects_formset.management_form }}
        <div id="projects_form" style="display: none;">
            <div id="projects_container-0">
                <table>
                    <tbody>
                        {% for project_form in projects_formset %}
                            <tr>
                                <th>Project Name</th>
                            </tr>
                            <td>{{ project_form.project_name.errors }} {{ project_form.project_name }}</td>

                            <tr>
                                <th>Project Skills</th>
                            </tr>
                            <td>{{ project_form.project_skills.errors }} {{ project_form.project_skills }}</td>

                            <tr>
                                <th>
                                    <b style="color: palevioletred;"> 
                                        Description of your project in simple English. What did you do? What technologies/skills did you use?
                                        What was the numerical impact/benefit? The more info you give, the better your resume will be.
                                        <a href="https://www.google.com" style="color: lightskyblue;" target="_blank"> Examples</a>
                                    </b>
                                </th>

                            </tr>
                            <td>{{ project_form.description.errors }} {{ project_form.description }}</td>

                        {% endfor %}
                    </tbody>
                </table>
                <button id="delete-project-form-0" type="button">Delete Project</button> <br>
            </div>
        </div>
        <button id="add-project-form" type="button" style="display: none;">Add Another Project</button>

        <script>
            let project_totalformNumberAdderHelper = 0;
            window.addEventListener('load', function() {
                let project_projectForm = document.querySelector("#projects_form");
                let project_addButton = document.querySelector("#add-project-form");
                let project_totalFormsField = document.querySelector("input[name='projects-TOTAL_FORMS']");
                let project_formNum = project_projectForm.children.length;
                project_totalformNumberAdderHelper = project_formNum;

                project_addButton.addEventListener('click', addProjectForm);

                function addProjectForm() {

                    console.log("Add button clicked!");


                    let project_newForm = `
                        <div id="projects_container-${project_totalFormsField.value}">
                            <table>
                                <tbody>
                                    <tr>
                                        <th>Project Name</th>
                                    </tr>
                                    <tr class="form-row">
                                        <td><input type="text" name="projects-${project_totalFormsField.value}-project_name"></td>
                                    </tr>
                                    <tr>
                                        <th>Project Skills</th>
                                    </tr>
                                    <tr class="form-row">
                                        <td><input type="text" name="projects-${project_totalFormsField.value}-project_skills"></td>
                                    </tr>
                                    <tr>

                                        <th>
                                            <b style="color: palevioletred;"> 
                                                Description of your project in simple English. What did you do? What technologies/skills did you use?
                                                What was the numerical impact/benefit? The more info you give, the better your resume will be.
                                                <a href="https://www.google.com" style="color: lightskyblue;" target="_blank"> Examples</a>
                                            </b>
                                        </th>

                                    </tr>
                                    <tr class="form-row">
                                        <td><textarea name="projects-${project_totalFormsField.value}-description"></textarea></td>
                                    </tr>
                                </tbody>
                            </table>
                            <button id="delete-project-form-${project_totalFormsField.value}" type="button">Delete Project</button>
                        </div>
                    `;

                    let project_container = document.createElement('div');
                    project_container.innerHTML = project_newForm;

                    project_projectForm.appendChild(project_container);

                    // Add delete button for the newly added form
                    let project_deleteButton = document.querySelector(`#delete-project-form-${project_totalFormsField.value}`);

                    project_deleteButton.addEventListener('click', function() {
                        project_deleteForm(project_container, project_formNum);
                    });
                    project_container.appendChild(project_deleteButton);

                    project_formNum++;
                    project_totalFormsField.value++;
                    project_totalformNumberAdderHelper++;
                    console.log(`Form added. project_totalformNumberAdderHelper: ${project_totalformNumberAdderHelper}`);
                    console.log(`Form added. projects-TOTAL_FORMS: ${project_totalFormsField.value}`);
                }


                function project_deleteForm(form, formNum) {

                    if (project_totalformNumberAdderHelper == 1) {
                        // If deleting the first form, just hide the project_form and set hasProjectExperience to 'no'
                        console.log("there is only 1 form so the radio button should become closed");
                        yesProjectRadio.checked = false;
                        noProjectRadio.checked = true;
                        project_projectForm.style.display = 'none';
                        project_addButton.style.display = 'none';
                        document.getElementById('noRadio').checked = true;
                    }
                    else {
                        form.remove();
                        project_totalformNumberAdderHelper--;
                        console.log(`after deleting, project_totalformNumberAdderHelper is : ${project_totalformNumberAdderHelper}`);
                        console.log(`after deleting, projects-TOTAL_FORMS is : ${project_totalFormsField.value}`);
                    }
                }

                let project_deleteButtons = document.querySelectorAll("[id^='delete-project-form-']");
                project_deleteButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        let project_formNum = parseInt(button.id.split('-').pop());
                        console.log("project form number " + project_formNum + " is being deleted");
                        project_deleteForm(project_projectForm.children[project_formNum], project_formNum);
                    });
                });

                document.getElementById("add-project-form").addEventListener('click', function() {
                let invalidInput = project_projectForm.querySelector('input:invalid, textarea:invalid');
                if (invalidInput) {
                    invalidInput.style.borderColor = 'red';
                    alert("Please fill out all fields in the project. The missing field has been highlighted in red.");
                    invalidInput.focus();
                    // Scroll to the position of the invalid input field
                    invalidInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                });

                myGlobalFunctions.addProjectForm = addProjectForm;

            });
        </script>


        {% if  account.user_profile.projects.exists %}

        <script>
            var number_of_projects = "{{account.user_profile.projects.count}}"
            console.log("number_of_projects is ", number_of_projects)


            if (number_of_projects > 0) {
                console.log("pre-loading previous projects")
                console.log("unhiding projects form and setting radio to yes")

                var projectForm = document.getElementById('projects_form');
                var yesRadioProject = document.getElementById('yesProjectRadio');
                var addProjectFormButton = document.getElementById('add-project-form');
                yesRadioProject.checked = true;

                projectForm.style.display = yesRadioProject.checked ? 'block' : 'none';
                addProjectFormButton.style.display = yesRadioProject.checked ? 'block' : 'none';


            }

            window.addEventListener('load', function() {
                projectForm = document.getElementById('projects_form');
                for (let i = 1; i < number_of_projects; i++) {
                    console.log("adding previous project number ", i)
                    console.log("workForm.children.length is" , projectForm.children.length)
                    myGlobalFunctions.addProjectForm();
                }

            });
        </script>


        {% for project in account.user_profile.projects.all %}
        <script>
            window.addEventListener('load', function() {
                var projectForm = document.getElementById('projects_form');
                

                {% with project_counter_index=forloop.counter0 %}
                var newFormInstance = `
                                <div id="projects_container-{{project_counter_index}}">
                                    <table>
                                        <tbody>
                                            <tr>
                                                <th>Project Name</th>
                                            </tr>
                                            <tr class="form-row">
                                                <td><input type="text" name="projects-{{project_counter_index}}-project_name" value="{{project.project_name}}" ></td>
                                            </tr>
                                            <tr>
                                                <th>Project Skills</th>
                                            </tr>
                                            <tr class="form-row">
                                                <td><input type="text" name="projects-{{project_counter_index}}-project_skills" value="{{project.project_skills}}" ></td>
                                            </tr>
                                            <tr>
                                                <th>
                                                    <b style="color: palevioletred;"> 
                                                        Description of your project in simple English. What did you do? What technologies/skills did you use?
                                                        What was the numerical impact/benefit? The more info you give, the better your resume will be.
                                                        <a href="https://www.google.com" style="color: lightskyblue;" target="_blank"> Examples</a>
                                                    </b>
                                                </th>
                                            </tr>

                                            <tr class="form-row">
                                                <td><textarea name="projects-{{project_counter_index}}-description">{{ project.bullet1 }}</textarea></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <button id="delete-project-form-{{project_counter_index}}" type="button">Delete Project</button>
                                </div>
                                `;

                {% endwith %}

                projectForm.children[{{ forloop.counter0 }}].innerHTML = newFormInstance;
                // console.log(projectForm.children[{{ forloop.counter0 }}].innerHTML)
            });
        </script>
        {% endfor %}

        <script>
            window.addEventListener('load', function() {
                var projectForm = document.getElementById('projects_form');

                if (projectForm) {
                    projectForm.addEventListener('click', function(event) {

                        // Check if the clicked element is a delete button
                        if (event.target.id.startsWith('delete-project-form-')) {
                            // Extract the index from the button id
                            var index = parseInt(event.target.id.split('-').pop());

                            // Check if the index is valid
                            if (!isNaN(index)) {
                                // Get the corresponding div with id "work_experiences_container-[index]"
                                var containerId = 'projects_container-' + index;
                                var containerToRemove = document.getElementById(containerId);

                                var containers = document.querySelectorAll('[id^="' + containerId + '"]');
                                var numberOfInstances = containers.length-1;
                                console.log("numberOfInstances", numberOfInstances)

                                // Check if the container element exists
                                if (containerToRemove) {
                                    if (project_totalformNumberAdderHelper == 1) {
                                        console.log("there is only 1 project so the radio button should become closed");
                                        projectForm.style.display = 'none';
                                        yesRadioProject.checked = false;
                                        document.getElementById('noProjectRadio').checked = true;

                                    } else {
                                        console.log("deleting workform container number" , index, containerId)
                                        console.log(containerToRemove)
                                        containerToRemove.remove();
                                        project_totalformNumberAdderHelper--;
                                        console.log("workForm.children.length" , workForm.children.length)
                                    }
                                    
                                } else {
                                    console.error('Container element does not exist.', containerId);
                                }
                            } else {
                                console.error('Invalid index or child element does not exist.', index);
                            }
                        }
                    });
                } else {
                    console.error('workForm is not defined.');
                }
            });
        </script>

        {% endif %}



    </div>

    <!-- validation -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var submitButton = document.querySelector('button[type="submit"]');
            submitButton.addEventListener('click', function (event) {
                // Prevent form submission
                event.preventDefault();

                var inputs = document.querySelectorAll('#dataForm input, #dataForm textarea');
                for (var i = 0; i < inputs.length; i++) {
                    if (inputs[i].value.trim() === '' && 
                    (inputs[i].getAttribute('name') != 'profile_image' && 
                        inputs[i].getAttribute('name') != 'linkedin_link' && 
                        inputs[i].getAttribute('name') != 'github_link' && 
                        inputs[i].getAttribute('name') != 'minor')) {
                        alert('Please fill in all fields before submitting the form. Missing field: ' + inputs[i].getAttribute('name'));
                        inputs[i].style.borderColor = 'red';
                        scrollToElement(inputs[i]);
                        return;
                    }

                    if (inputs[i].getAttribute('name') == 'state') {
                        if (inputs[i].value.trim().length !== 2) {
                            alert('Please ensure state is 2 letters only');
                            inputs[i].style.borderColor = 'red';
                            scrollToElement(inputs[i]);
                            return;
                        }
                    }

                }


                // Check if work experience form is displayed
                var workForm = document.getElementById('work_form');
                if (workForm.style.display !== 'none') {
                    // Validate each field in the work experience form
                    var workForms = document.getElementsByClassName('form-row');
                    for (var i = 0; i < workForms.length; i++) {
                        var inputs = workForms[i].getElementsByTagName('input');
                        var textareas = workForms[i].getElementsByTagName('textarea');

                        // Validate input fields
                        for (var j = 0; j < inputs.length; j++) {
                            if (inputs[j].value.trim() === '') {
                                inputs[j].style.borderColor = 'red';
                                alert('Please fill in the "' + inputs[j].getAttribute('name') + '" field in the work experience form.');
                                scrollToElement(inputs[j]);
                                return;
                            } else {
                                inputs[j].style.borderColor = ''; // Reset border color
                            }
                        }

                        // Validate textarea fields
                        for (var k = 0; k < textareas.length; k++) {
                            if (textareas[k].value.trim() === '') {
                                textareas[k].style.borderColor = 'red';
                                alert('Please fill in the "' + textareas[k].getAttribute('name') + '" field in the work experience form.');
                                scrollToElement(textareas[k]);
                                return;
                            } else {
                                textareas[k].style.borderColor = ''; // Reset border color
                            }
                        }
                    }
                }

                var projectForm = document.getElementById('projects_form');
                if (projectForm.style.display !== 'none') {
                    // Validate each field in the projects form
                    var projectForms = document.querySelectorAll('#projects_form input, #projects_form textarea');
                    for (var i = 0; i < projectForms.length; i++) {
                        if (projectForms[i].value.trim() === '') {
                            projectForms[i].style.borderColor = 'red';
                            alert('Please fill in the "' + projectForms[i].getAttribute('name') + '" field in the projects form.');
                            scrollToElement(projectForms[i]);
                            return;
                        } else {
                            projectForms[i].style.borderColor = ''; // Reset border color
                        }
                    }
                }


                // If validation passes, submit the form
                document.querySelector('form').submit();

                // Show the loading modal and overlay
                document.getElementById("loadingModal").style.display = "block";
                document.getElementById("loadingOverlay").style.display = "block";
        
                // Array of loading messages
                var loadingMessages = [
                    "{{account.name}}, welcome to displayai ! ",
                    "Requesting displayai AI & data science model  ...",
                    "Connecting to cloud environment & creating resume google doc ...",
                    "Adding data to personal website & resume",
                    "Artificial Intelligence to generate bullets...",
                    "Prompt engineering ...",
                    "Data Science model to select the optimal bullets ...",
                    "Natural Language Processing to make resume ATS friendly...",
                    "Model to ensure resume bullets are short, concise ...",
                    "Artificial Intelligence to ensure bullets quantification ...",
                    "Cleaning bullet data and pushing to profile environment  ...",
                    "Personal website ready ! ",
                    "Editing google doc permissions ... ",
                    "Ensuring account security ... ",
                    "Formatting work experiences",
                    "Formatting projects",
                    "Formatting dates",
                    "Saving resume to cloud environment",
                    "Saving resume to profile",
                    "Updating your account information",
                    "Model is running slow due to traffic please be patient ... ",
                    "Your internet connection is slowing model please be patient ... ",
                    "Checking for errors ... ",
                    "Ensuring account security ... ",
                    "Model is running slow due to traffic please be patient ... ",
                    "Your internet connection is slowing model please be patient ... ",
                    "Ensuring account security ... ",
                    "Model is running slow due to traffic please be patient ... ",
                    "Your internet connection is slowing model please be patient ... ",
                    "Ensuring account security ... ",
                    "Model is running slow due to traffic please be patient ... ",
                    "Your internet connection is slowing model please be patient ... ",
                    "Ensuring account security ... ",
                    "Your internet is too slow please try again ... ",
                    "Your internet is too slow please try again ... ",
                    "Your internet is too slow please try again ... ",
                    "Your internet is too slow please try again ... ",
                    "Your internet is too slow please try again ... ",
                    "Your internet is too slow please try again ... ",
                ];
        
                // Function to display loading messages in a loop
                function displayLoadingMessages(index) {
                    // Set the loading text
                    document.getElementById("loadingText").innerHTML = "<b>" + loadingMessages[index] + "</b>";
        
                    // Increment index or reset to 0 if at the end
                    index = (index + 1) % loadingMessages.length;
        
                    // Set a timeout for the next message
                    setTimeout(function () {
                        displayLoadingMessages(index);
                    }, 1700); // Adjust the time delay between messages (in milliseconds)
                }
        
                // Start the loop
                displayLoadingMessages(0);
            

            });

            function scrollToElement(element) {
                // Scroll to the element
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

                
        });
    </script>

        {% if account.user_profile is None %}
        <button type="submit"">CREATE USER PROFILE AND BUILD WEBSITE AND RESUME</button>
        {% else %}
        <button type="submit"">UPDATE USER PROFILE AND BUILD WEBSITE AND RESUME</button>
        {% endif %}

        <style>
            /* Style for the modal */
            #loadingModal {
                display: none;
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: #f9bb75; /* White background */
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
                text-align: center;
                animation: fadeIn 0.5s ease-in-out;
                z-index: 1000; /* Ensure the modal appears above the rest of the content */
            }
        
            /* Animation for the modal */
            @keyframes fadeIn {
                from {
                    opacity: 0;
                }
                to {
                    opacity: 1;
                }
            }
        
            /* Style for the background overlay */
            #loadingOverlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5); /* Adjust the color and opacity as needed */
                backdrop-filter: blur(3px); /* Add a blur effect to the background */
                z-index: 999; /* Ensure the overlay is behind the modal but above the rest of the content */
                display: none;
            }
        </style>
        
        <div id="loadingModal">
            <p id="loadingText"><b>Loading...</b></p>
        </div>
        
        <div id="loadingOverlay"></div>
        
        <script>
            function showLoadingModal() {
                // Show the loading modal and overlay
                document.getElementById("loadingModal").style.display = "block";
                document.getElementById("loadingOverlay").style.display = "block";
        
                // Array of loading messages
                var loadingMessages = [
                    "{{account.name}}, welcome to displayai ! ",
                    "Requesting displayai AI & data science model  ...",
                    "Connecting to cloud environment & creating resume google doc ...",
                    "Adding data to personal website & resume",
                    "Artificial Intelligence to generate bullets...",
                    "Prompt engineering ...",
                    "Data Science model to select the optimal bullets ...",
                    "Natural Language Processing to make resume ATS friendly...",
                    "Model to ensure resume bullets are short, concise ...",
                    "Artificial Intelligence to ensure bullets quantification ...",
                    "Cleaning bullet data and pushing to profile environment  ...",
                    "Personal website ready ! ",
                    "Editing google doc permissions ... ",
                    "Ensuring account security ... ",
                    "Formatting work experiences",
                    "Formatting projects",
                    "Formatting dates",
                    "Saving resume to cloud environment",
                    "Saving resume to profile",
                    "Updating your account information",
                    "Model is running slow due to traffic please be patient ... ",
                    "Your internet connection is slowing model please be patient ... ",
                    "Checking for errors ... ",
                    "Ensuring account security ... ",
                    "Model is running slow due to traffic please be patient ... ",
                    "Your internet connection is slowing model please be patient ... ",
                    "Ensuring account security ... ",
                    "Model is running slow due to traffic please be patient ... ",
                    "Your internet connection is slowing model please be patient ... ",
                    "Ensuring account security ... ",
                    "Model is running slow due to traffic please be patient ... ",
                    "Your internet connection is slowing model please be patient ... ",
                    "Ensuring account security ... ",
                    "Your internet is too slow please try again ... ",
                    "Your internet is too slow please try again ... ",
                    "Your internet is too slow please try again ... ",
                    "Your internet is too slow please try again ... ",
                    "Your internet is too slow please try again ... ",
                    "Your internet is too slow please try again ... ",
                ];
        
                // Function to display loading messages in a loop
                function displayLoadingMessages(index) {
                    // Set the loading text
                    document.getElementById("loadingText").innerHTML = "<b>" + loadingMessages[index] + "</b>";
        
                    // Increment index or reset to 0 if at the end
                    index = (index + 1) % loadingMessages.length;
        
                    // Set a timeout for the next message
                    setTimeout(function () {
                        displayLoadingMessages(index);
                    }, 1700); // Adjust the time delay between messages (in milliseconds)
                }
        
                // Start the loop
                displayLoadingMessages(0);
        
                // You can add additional logic or AJAX requests if needed here
            }
        </script>

    <br>  <br>  <br>  <br>
</form>

    <br>  <br>  <br>  <br>  <br>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

{% endblock %}