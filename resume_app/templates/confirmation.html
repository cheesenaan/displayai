{% extends 'index.html' %}
{% load static %}


{% block header_links %}
        <a href="{% url 'account' account_id=account.id %}">  Account </a>
        <a href="{% url 'subscriptions' account_id=account.id %}">  Orders </a>
        <a href="#pricing"> Pricing </a>

{% endblock %}



{% block header_links_nav %}
        <a href="{% url 'account' account_id=account.id %}">  Account </a>
        <a href="{% url 'subscriptions' account_id=account.id %}">  Orders </a>
        <a href="#pricing"> Pricing </a>

{% endblock %}


{% block content %}



<style>

    html {
        scroll-behavior: smooth;
    }

    @media (min-width: 768px) {
        .right-section, .left-section {
            width: 47%;
        }
    }
        
    
        body {
        background-color: #1a1a1a;
        color: #c9d1d9;
        font-family: 'Arial', sans-serif;
        line-height: 1.6;
    }
    
    h2, h3 {
        color: #ffd60a;
        margin-bottom: 10px;
    }
    
    a {
        color: #ffd60a;
        text-decoration: none;
    }
    
    
    
    /* Button Styles */
    .btn {
        display: inline-block;
        background-color: #238636;
        color: #ffffff;
        padding: 10px 20px;
        border-radius: 5px;
        text-decoration: none;
        margin: 8px 0;
        transition: background-color 0.3s ease, transform 0.2s ease;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    
    .btn:hover {
        background-color: #2ea043;
        transform: translateY(-2px);
    }
    
    .button:hover {
        background-color: #721c24;
        transform: translateY(-2px);
    }
    
    /* Container and Row Styles */
    .row {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        justify-content: space-between;
        max-width: auto;
        padding: 0 15px;
    }
    
    /* Column Styles */
    .column {
        background-color: #1c1c1c;
        padding: 20px;
        border-radius: 10px;
        flex: 1;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        transition: transform 0.3s ease;
    }
    
    
    
    /* Rebuild Options Section */
    .rebuild-options {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    /* Button Group Styles */
    .button-group {
        display: flex;
        flex-direction: column;
        gap: 15px;
        align-items: center;
    }
    
    
    /* QR Code Styles */
    .qr-code {
        margin-top: 20px;
        width: 120px;
        height: auto;
        border-radius: 8px;
        transition: transform 0.2s ease;
    }
    
    .qr-code:hover {
        transform: scale(1.05);
    }
    
    /* Responsive Styles */
    @media (max-width: 992px) {
        .row {
            flex-direction: column;
            gap: 20px;
        }
    
        .column {
            padding: 20px;
        }
    }
    
    @media (max-width: 768px) {
        .google-doc-embed iframe {
            height: 400px;
        }
    
        .btn {
            width: 100%;
            max-width: 250px;
        }
    }
    
    /* Additional Styling for Interactive Elements */
    #landed_section {
        background-color: #1a1a1a;
        padding: 20px;
        margin-bottom: 40px;
    }
    
    #landed_section h2 {
        margin-bottom: 20px;
    }
    
    .account-link {
        margin-top: 10px;
    }
    
    h3 {
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .column.website {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    
    .website p {
        margin-top: 10px;
    }
    
    .column.resume {
        padding-top: 0;
    }
    
    
    /* Styles for the embedded resume iframe */
    #resumeIframe {
        transform: scale(0.6);
        transform-origin: 0 0;
        width: 170%;
        border-radius: 40px;
        height: 1250px;
    }
    
    
    
    </style>


<style>
.button1 {
    display: inline-block;
    padding: 10px 20px;
    color: #fff;
    background-color: #6200ea;
    border: none;
    border-radius: 5px;
    text-align: center;
    text-decoration: none;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.button1:hover {
    background-color: #ffd60a;
    color: #1a1a1a;
}

.button1:active {
    background-color: #ffd60a;
}


</style>



<style>
    /* Flexbox Container */
    .info-website-container {
        display: flex;
        justify-content: space-between;
        gap: 20px;
        padding: 40px;
        border-radius: 8px;
        margin-bottom: 40px;
    }
    
    /* Columns */
    .column {
        flex: 1;
    }

    /* User Info Table */
    .user-info-table table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        color: #ffffff; /* Set all text in the table to white */
    }

    .user-info-table td {
        padding: 8px;
        border-bottom: 1px solid #444; /* Darker border for better visibility */
    }

    .user-info-table td:first-child {
        font-weight: bold;
        color: #ffffff; /* Ensure first column text is also white */
    }

    /* Website Section */
    .website {
        text-align: center;
        color: #ffffff; /* Ensure text in the website section is white */
    }

    .website a {
        color: #00bfff; /* Light blue color for links */
        text-decoration: none;
    }

    .website a:hover {
        text-decoration: underline;
    }

    .qr-code {
        margin-top: 10px;
        max-width: 150px;
        height: auto;
    }

    /* Adjust GIF to be responsive */
    #resume-video {
        width: 100%; /* Make the image take up full width of its container */
        max-width: 300px; /* Optional: max width to prevent the image from getting too large */
        height: auto; /* Maintain aspect ratio */
        border-radius: 10px; /* Optional: add rounded corners */
    }

    /* Media Queries for Smaller Screens */
    @media (max-width: 768px) {

        body, html {
            max-width: 100%;
        }

        .info-website-container {
            flex-direction: column; /* Stack the columns vertically */
            padding: 0px; /* Reduce padding for smaller screens */
            max-width: 100%;
        }

        .column {
            flex: none; /* Allow the columns to stack and not stretch */
            width: 100%; /* Ensure columns take up full width */
            margin-bottom: 20px; /* Add margin between stacked columns */
        }

        .arrow {
            font-size: 60px; /* Reduce arrow size for smaller screens */
            margin-top: 5px; /* Adjust margin for smaller screens */
        }

        .qr-code {
            max-width: 120px; /* Reduce QR code size on smaller screens */
        }

        .user-info-table td {
            font-size: 14px; /* Reduce font size for smaller screens */
            padding: 6px; /* Adjust padding for readability */
        }

        .user-info-table td:first-child {
            font-size: 16px; /* Slightly larger font for labels */
        }

        .website a {
            font-size: 18px; /* Adjust link font size */
        }
    }

    @media (max-width: 480px) {
        .arrow {
            font-size: 50px; /* Further reduce arrow size for very small screens */
        }

        .user-info-table td {
            font-size: 12px; /* Make text smaller for very small screens */
            padding: 4px; /* Further reduce padding */
        }

        .user-info-table td:first-child {
            font-size: 14px; /* Ensure the first column text is still readable */
        }

        .qr-code {
            max-width: 100px; /* Further reduce QR code size */
        }

        .website a {
            font-size: 16px; /* Make text slightly smaller */
        }
    }
</style>

<html>


<section id="main">

<section id="landed_section" style="text-align: center;">
    <h2>{{user_profile.first_name}}'s Build Page</h2>
    <a href="{% url 'account' account_id=account.id %}" class="button1">All Resume Links</a>


    <div> 
        {% if remaining < 0 %}
                <h1>{{user_profile.first_name}}, {{ account.tier }} version limit reached, you must upgrade your <a href="#pricing"> plan </a> </h1>
        {% endif %}
    
        <!-- messages -->
        <div>

            <style>


                .messages li {
                    margin: 5px 0;
                    padding: 10px;
                    border-radius: 5px;
                }

                .messages li.success {
                    color: #155724;
                    background-color: #d4edda;
                    border-color: #c3e6cb;
                    font-weight: bold;
                    width: 100%;
                }

                .messages li.error {
                    color: #721c24;
                    background-color: #f8d7da;
                    border-color: #f5c6cb;
                    font-weight: bold;
                    width: 100%;
                }
            </style>

            {% if remaining == 0 %}
                    <span style="color: red; font-weight: bold;">
                        {{ account.tier }} version limit reached, view our <a href="#pricing"> pricing plans </a>
                    </span> <br>
            {% endif %}

            {% if messages %}
                <ul class="messages">
                {% for message in messages %}
                    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                {% endfor %}
                </ul>

            {% endif %}

        </div>

    </div>

</section>


<!-- Container for User Info and Website Sections -->
<div class="info-website-container">
    <!-- User Info Table Column -->
    

    <!-- Website Column -->
    <div class="column website">
        <h3>Website</h3>
        <p>
            <a href="/{{account.name}}" target="_blank">
                <b>üåê cheesecv.com/{{account.name}}</b>
            </a>
        </p>
        <img src="data:image/png;base64,{{qr_code_image}}" alt="QR Code" class="qr-code">
    </div>

    <!-- Website Column -->
    <div class="column website">
    <a href="#build_options_resume_section" style="text-decoration: none;">
        <h3>Resume</h3>
        

        <script>
            // Define a variable to hold the HTML content
            let content0 = '';
    
            // Check if the user is on a mobile device
            if (/Mobi|Android/i.test(navigator.userAgent)) {
                // Message for mobile users
                content0 = '<b style="color: white;">Build at least 4 times for optimal bullets.<br>' +
                          '<span style="color: red;">Shrunk on mobile, view on PC</span></b>' +
                          '<h3 id="googleDocLink" style="display: inline;"><a href="#" target="_blank" id="googleDocAnchor">Link to Google Doc</a></h3>';
            } else {
                // Message for non-mobile users
                content0 = '<span class="arrow">&#8595;</span>';
            }
    
            // Insert the content into the div
            document.write(content0);
        </script>

    </a>
    </div>

    <div class="column user-info-table">
        <table>
            <tr>
                <td>Your Tier:</td>
                <td>{{account.tier}}</td>
            </tr>
            <tr>
                <td>Total Created on {{account.tier}}:</td>
                <td>{{user_plan.forms_filled_on_current_plan}}</td>
            </tr>
            <tr>
                <td>Total Tailored Resumes:</td>
                <td>{{user_plan.total_tailored_resumes}}</td>
            </tr>
            <tr>
                <td>Total Cover Letters:</td>
                <td>{{user_plan.total_cover_letters}}</td>
            </tr>
            <tr>
                <td>Total Created on all tiers:</td>
                <td>{{user_plan.total_forms_filled}}</td>
            </tr>
            <tr>
                <td><b>Builds Remaining:</b></td>
                <td><b>{{remaining}}</b></td>
            </tr>
        </table>
    </div>
    
    <style>
        .arrow {
    font-size: 100px; /* Size of the arrow */
    color: white; /* Color of the arrow */
    margin-top: 8px;
}
    </style>

</div>


<!-- New Build Options and Resume Section -->
<section id="build_options_resume_section">
    <div class="row">
        <!-- Rebuild Options Column (Left) -->

        <div class="left-section"> 

           

                <script>
                    // Define a variable to hold the HTML content
                    let content = '';
            
                    // Check if the user is on a mobile device
                    if (/Mobi|Android/i.test(navigator.userAgent)) {

                    } else {
                        // Message for non-mobile users
                        content = ' <div class="gap" style="height: 30px;"></div>' +
                        '<div class="column website">' +
                        '<span style="font-weight: bold;">Build at least 4 times for optimal bullets</span>' + 
                        '<h3 id="googleDocLink" style="display: inline;"><a href="#" target="_blank" id="googleDocAnchor">Link to Google Doc</a></h3>' + 
                        '</div>';

                    }
            
                    // Insert the content into the div
                    document.write(content);
                </script>
            
            
            <div class="gap" style="height: 30px;"></div>


            <div class="column rebuild-options">
                <h3>Rebuild Options</h3>
                <div class="button-group">
                    
                    <!-- re build with the same dta -->
                    <div id="re-build-same-data">
                        {% if remaining > 0 %}
                            <button class="left-button" onclick="handleRebuildRequest()">
                                Re-Build with same data
                            </button>
                    
                            <!-- Loading Modal -->
                            <div id="loadingModal">
                                <div class="loading-spinner"></div>
                                <p id="loadingText"><b>Loading...</b></p>
                            </div>
                            <div id="loadingOverlay"></div>
                    
                            <script>
                                function showLoadingModal() {
                                    // Show the loading modal and overlay
                                    document.getElementById("loadingModal").style.display = "flex";
                                    document.getElementById("loadingOverlay").style.display = "block";
                    
                                    // Array of loading messages
                                    const loadingMessages = [
                                        "{{account.name}}, welcome to displayai!",
                                        "Requesting displayai AI & data science model...",
                                        "Connecting to cloud environment & creating resume Google Doc...",
                                        "Adding data to personal website & resume...",
                                        "Artificial Intelligence to generate bullets...",
                                        "Finalizing resume details...",
                                        "Ensuring optimal formatting...",
                                        "Saving resume to cloud...",
                                        "Your personal website is ready!",
                                        "All set! Finalizing...",
                                    ];
                    
                                    let index = 0;
                    
                                    function displayLoadingMessages() {
                                        document.getElementById("loadingText").innerHTML = `<b>${loadingMessages[index]}</b>`;
                                        index = (index + 1) % loadingMessages.length;
                                        setTimeout(displayLoadingMessages, 1700);
                                    }
                    
                                    // Start displaying messages
                                    displayLoadingMessages();
                                }
                    
                                async function handleRebuildRequest() {
                                    // Show the loading modal
                                    showLoadingModal();
                    
                                    try {
                                        // Make an API call using fetch
                                        const response = await fetch("{% url 'reload_resume_and_website' account_id=account.id %}", {
                                            method: 'GET', // Use 'POST' if your endpoint requires it
                                            headers: {
                                                'Content-Type': 'application/json',
                                                'X-Requested-With': 'XMLHttpRequest', // Ensures it's recognized as an AJAX request
                                            },
                                        });
                    
                                        // Check if the response is successful
                                        if (response.ok) {
                                            console.log('API call successful');
                                            window.location.reload(); // Reload the page to show updated content
                                        } else {
                                            console.error('API call failed');
                                            alert('There was an issue with your request. Please try again.');
                                        }
                                    } catch (error) {
                                        console.error('Error:', error);
                                        alert('An error occurred. Please try again later.');
                                    } finally {
                                        // Hide the loading modal after the request is complete
                                        document.getElementById("loadingModal").style.display = "none";
                                        document.getElementById("loadingOverlay").style.display = "none";
                                    }
                                }
                            </script>
                    
                        {% else %}
                            <button class="left-button" onclick="edit_data_redirect_pricing()">Re-Build with same data</button>
                        {% endif %}
                    </div>

                    <style>

                        /* Loading Modal Styles */
                        #loadingModal {
                            display: none;
                            position: fixed;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background-color: rgba(0, 0, 0, 0.9);
                            border-radius: 10px;
                            padding: 20px;
                            z-index: 1001;
                            text-align: center;
                            color: #ffd60a;
                            flex-direction: column;
                            align-items: center;
                        }

                        #loadingOverlay {
                            display: none;
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background-color: rgba(0, 0, 0, 0.5);
                            z-index: 1000;
                        }

                        /* Spinner Styles */
                        .loading-spinner {
                            border: 5px solid rgba(255, 255, 255, 0.3);
                            border-top: 5px solid #ffd60a;
                            border-radius: 50%;
                            width: 50px;
                            height: 50px;
                            animation: spin 1s linear infinite;
                            margin-bottom: 15px;
                        }

                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }

                    </style>
                    
                    <!-- edit data and rebuild -->
                    <div id="edit-data-and-rebuild">
                        <!-- <p>Want to edit your data ? </p> -->
                        {% if remaining > 0 %}
                        <a href="{{ redirect_domain }}{{ account.id }}/form" class="left-button">
                            Edit data & Re-Build
                        </a>
                        {% else %}
                        <button class="left-button" onclick="edit_data_redirect_pricing()">Edit data & Re-Build </button>
    
                        <script>
                            function edit_data_redirect_pricing() {
                                alert("Your verison has ended, please upgrade plan");
                                var accountId = "{{ account.id }}"; // Make sure account.id is properly rendered
                                var redirectDomain = "{{ redirect_domain }}";
                                var confirmationUrl = redirectDomain + '' + accountId + '/confirmation#pricing';
                                window.location.href = confirmationUrl;
    
                            }
                        </script>
                        {% endif %}
                    </div>

                    <style>
                        #edit-data-and-rebuild {
                                text-align: center;
                            }

                            .left-button {
                                display: inline-block;
                                padding: 12px 10px;
                                font-size: 16px;
                                font-weight: bold;
                                text-align: center;
                                color: #1c1c1c;
                                background-color: #ffc107; /* Primary button color */
                                border: none;
                                border-radius: 8px;
                                text-decoration: none;
                                cursor: pointer;
                                transition: background-color 0.3s ease, transform 0.2s ease;
                            }

                            .left-button:hover {
                                background-color: #ee4d29; /* Darker shade on hover */
                                transform: translateY(-2px); /* Slight lift on hover */
                            }

                            .left-button:active {
                                background-color: #ee4d29; /* Even darker shade on click */
                                transform: translateY(0); /* Remove lift effect on click */
                            }

                            .left-button[disabled],
                            .left-button[disabled]:hover {
                                background-color: #b5b5b5; /* Disabled state color */
                                cursor: not-allowed;
                                transform: none; /* No hover effect when disabled */
                            }

                    </style>
                    
                   <!-- Job Description Modal -->
                    <div>
                        <!-- Job Description Rebuild Section -->
                        <div id="jobDescription-rebuild" class="rebuild-options">
                            {% if remaining > 0 %}
                            <!-- Button to Open Job Description Modal -->
                            <button class="left-button" onclick="openJobDescriptionModal()">
                                Build job description tailored resume
                            </button>
                            {% else %}
                            <!-- Redirect to Pricing if Plan Expired -->
                            <button class="left-button" onclick="redirectToPricing()">
                                Build job description tailored resume
                            </button>
                            {% endif %}
                        </div>

                        <!-- Job Description Modal -->
                        <div id="jobDescriptionModal" class="custom-fullscreen-modal" style="display: none;">
                            <div class="modal-content">
                                <div class="modal-left">
                                    <h3>Tailored Resume Builder</h3>
                                    <label for="jobDescriptionInput" class="form-label">Input Job Description:</label>
                                    <textarea id="jobDescriptionInput" class="form-control" placeholder="Paste your job description here..."></textarea>
                                    <div class="modal-buttons">
                                        <button class="btn" onclick="submitJobDescription()">Build tailored resume</button>
                                        <button class="btn btn-secondary" onclick="closeJobDescriptionModal()">Close</button>
                                    </div>
                                </div>
                                <div class="modal-right">
                                    <img id="coverLetterGif" src="{% static 'images/marketing.gif' %}" alt="GIF coming soon">
                                </div>
                            </div>
                        </div>

                        <!-- Loading Indicator -->
                        <div id="loadingOverlay" class="loading-overlay" style="display: none;">
                            <div class="loading-spinner"></div>
                            <p>Building your tailored resume...</p>
                        </div>

                        <script>
                            function redirectToPricing() {
                                alert("Your version has ended, please upgrade your plan.");
                                const accountId = "{{ account.id }}";
                                const redirectDomain = "{{ redirect_domain }}";
                                const confirmationUrl = `${redirectDomain}${accountId}/confirmation#pricing`;
                                window.location.href = confirmationUrl;
                            }

                            function openJobDescriptionModal() {
                                document.getElementById('jobDescriptionModal').style.display = 'flex';
                            }

                            function closeJobDescriptionModal() {
                                document.getElementById('jobDescriptionModal').style.display = 'none';
                            }

                            async function submitJobDescription() {
                                const jobDescription = document.getElementById('jobDescriptionInput').value.trim();

                                if (!jobDescription) {
                                    alert("Please enter a job description.");
                                    return;
                                }

                                closeJobDescriptionModal();
                                showLoading();

                                try {
                                    const response = await fetch("{% url 'reload_resume_and_website_with_job_description' account_id=account.id %}?JOB_DESCRIPTION=" + encodeURIComponent(jobDescription), {
                                        method: 'GET',
                                        headers: {
                                            'Content-Type': 'application/json',
                                            'X-Requested-With': 'XMLHttpRequest'
                                        }
                                    });

                                    if (response.ok) {
                                        console.log('API call successful');
                                        window.location.reload();
                                    } else {
                                        console.error('API call failed');
                                        alert('There was an issue with your request. Please try again.');
                                    }
                                } catch (error) {
                                    console.error('Error:', error);
                                    alert('An error occurred. Please try again later.');
                                } finally {
                                    hideLoading();
                                }
                            }

                            function showLoading() {
                                document.getElementById('loadingOverlay').style.display = 'flex';
                            }

                            function hideLoading() {
                                document.getElementById('loadingOverlay').style.display = 'none';
                            }
                        </script>

                        <!-- Additional Styles -->
                        <style>
                            
                            /* Button Styles */
                            .btn {
                                display: inline-block;
                                background-color: #ffd60a;
                                color: #ffffff;
                                padding: 10px 20px;
                                border-radius: 5px;
                                text-decoration: none;
                                margin: 8px 0;
                                transition: background-color 0.3s ease, transform 0.2s ease;
                                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
                            }

                            .btn:hover {
                                background-color: #2ea043;
                                transform: translateY(-2px);
                            }

                            /* Fullscreen Modal Styles */
                            .custom-fullscreen-modal {
                                position: fixed;
                                top: 0;
                                left: 0;
                                width: 100%;
                                height: 100%;
                                background-color: rgba(0, 0, 0, 0.8);
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                z-index: 9999;
                            }

                            .modal-content {
                                background-color: #1c1c1c;
                                display: flex;
                                flex-direction: row;
                                width: 70%;
                                height: 70%;
                                border-radius: 10px;
                                overflow: hidden;
                                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
                            }

                            /* Modal Left Section (Form) */
                            .modal-left {
                                flex: 1;
                                padding: 20px;
                                display: flex;
                                flex-direction: column;
                                justify-content: center;
                            }

                            .form-label {
                                font-weight: bold;
                                margin-bottom: 10px;
                            }

                            .form-control {
                                width: 100%;
                                height: 250px;
                                border-radius: 8px;
                                background-color: #2d2d2d;
                                color: #ffffff;
                                border: none;
                                padding: 10px;
                                margin-bottom: 20px;
                            }

                            /* Modal Right Section (GIF) */
                            .modal-right {
                                flex: 1;
                                background-color: #1a1a1a;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            }

                            .marketing-gif {
                                max-width: 100%;
                                max-height: 100%;
                                border-radius: 10px;
                            }

                            /* Loading Overlay */
                            .loading-overlay {
                                position: fixed;
                                top: 0;
                                left: 0;
                                width: 100%;
                                height: 100%;
                                background-color: rgba(255, 215, 10, 0.7); /* Cheese yellow */
                                display: flex;
                                flex-direction: column;
                                align-items: center;
                                justify-content: center;
                                z-index: 9999;
                                color: #1a1a1a;
                                font-family: 'Arial', sans-serif;
                                font-size: 20px;
                                border-radius: 10px;
                            }

                            .loading-spinner {
                                border: 4px solid #f3f3f3;
                                border-top: 4px solid #ffd60a;
                                border-radius: 50%;
                                width: 50px;
                                height: 50px;
                                animation: spin 1s linear infinite;
                            }

                            @keyframes spin {
                                0% { transform: rotate(0deg); }
                                100% { transform: rotate(360deg); }
                            }

                            /* Responsive Styles */
                            @media (max-width: 992px) {
                                .modal-content {
                                    flex-direction: column;
                                    height: 80%;
                                }

                                .modal-left,
                                .modal-right {
                                    height: 50%;
                                }
                            }
                        </style>
                    </div>

                   <!-- cover letter feature -->
                   <div>

                    <!-- Cover Letter Feature -->
                    <div>
                        <!-- Cover Letter Rebuild Section -->
                        <div id="coverLetter-rebuild" class="rebuild-options">
                            {% if remaining > 0 %}
                                <!-- Button to Open Cover Letter Modal -->
                                <button class="left-button" onclick="openCoverLetterModal()">
                                    Build Cover Letter for a Job Description
                                </button>
                            {% else %}
                                <!-- Redirect to Pricing if Plan Expired -->
                                <button class="left-button" onclick="redirectToPricing()">
                                    Build Cover Letter for a Job Description
                                </button>
                            {% endif %}
                        </div>

                        <!-- Cover Letter Modal -->
                        <div id="coverLetterModal" class="custom-fullscreen-modal" style="display: none;">
                            <div class="modal-content">
                                <div class="modal-left">
                                    <h3>Tailored Cover Letter Builder</h3>
                                    <label for="coverLetterDescriptionInput" class="form-label">Input Job Description:</label>
                                    <textarea id="coverLetterDescriptionInput" class="form-control" placeholder="Paste your job description here..."></textarea>
                                    <div class="modal-buttons">
                                        <button class="btn" onclick="submitCoverLetter()">Build Cover Letter</button>
                                        <button class="btn btn-secondary" onclick="closeCoverLetterModal()">Close</button>
                                    </div>
                                </div>
                                <div class="modal-right">
                                    <img id="coverLetterGif" src="{% static 'images/marketing.gif' %}" alt="GIF coming soon">
                                </div>
                            </div>
                        </div>

                        <!-- Loading Indicator -->
                        <div id="loadingOverlay" class="loading-overlay" style="display: none;">
                            <div class="loading-spinner"></div>
                            <p>Building your tailored cover letter...</p>
                        </div>

                        <script>
                            function redirectToPricing() {
                                alert("Your version has ended, please upgrade your plan.");
                                const accountId = "{{ account.id }}";
                                const redirectDomain = "{{ redirect_domain }}";
                                const confirmationUrl = `${redirectDomain}${accountId}/confirmation#pricing`;
                                window.location.href = confirmationUrl;
                            }

                            function openCoverLetterModal() {
                                document.getElementById('coverLetterModal').style.display = 'flex';
                            }

                            function closeCoverLetterModal() {
                                document.getElementById('coverLetterModal').style.display = 'none';
                            }

                            async function submitCoverLetter() {
                                const jobDescription = document.getElementById('coverLetterDescriptionInput').value.trim();

                                if (!jobDescription) {
                                    alert("Please enter a job description.");
                                    return;
                                }

                                closeCoverLetterModal();
                                showLoading();

                                try {
                                    const response = await fetch("{% url 'build_cover_letter' account_id=account.id %}?JOB_DESCRIPTION=" + encodeURIComponent(jobDescription), {
                                        method: 'GET',
                                        headers: {
                                            'Content-Type': 'application/json',
                                            'X-Requested-With': 'XMLHttpRequest'
                                        }
                                    });

                                    if (response.ok) {
                                        console.log('API call successful');
                                        window.location.reload();
                                    } else {
                                        console.error('API call failed');
                                        alert('There was an issue with your request. Please try again.');
                                    }
                                } catch (error) {
                                    console.error('Error:', error);
                                    alert('An error occurred. Please try again later.');
                                } finally {
                                    hideLoading();
                                }
                            }

                            function showLoading() {
                                document.getElementById('loadingOverlay').style.display = 'flex';
                            }

                            function hideLoading() {
                                document.getElementById('loadingOverlay').style.display = 'none';
                            }
                        </script>

                        <!-- Additional Styles -->
                        <style>
                        /* General Styles */
                       

                        /* Button Styles */
                        .btn {
                            display: inline-block;
                            background-color: #ffd60a;
                            color: #ffffff;
                            padding: 10px 20px;
                            border-radius: 5px;
                            text-decoration: none;
                            margin: 8px 0;
                            transition: background-color 0.3s ease, transform 0.2s ease;
                            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
                        }

                        .btn:hover {
                            background-color: #2ea043;
                            transform: translateY(-2px);
                        }

                        /* Fullscreen Modal Styles */
                        .custom-fullscreen-modal {
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background-color: rgba(0, 0, 0, 0.8);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            z-index: 9999;
                        }

                        .modal-content {
                            background-color: #1c1c1c;
                            display: flex;
                            flex-direction: row;
                            width: 70%;
                            height: 70%;
                            border-radius: 10px;
                            overflow: hidden;
                            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
                        }

                        /* Modal Left Section (Form) */
                        .modal-left {
                            flex: 1;
                            padding: 20px;
                            display: flex;
                            flex-direction: column;
                            justify-content: center;
                        }

                        .form-label {
                            font-weight: bold;
                            margin-bottom: 10px;
                        }

                        .form-control {
                            width: 100%;
                            height: 250px;
                            border-radius: 8px;
                            background-color: #2d2d2d;
                            color: #ffffff;
                            border: none;
                            padding: 10px;
                            margin-bottom: 20px;
                        }

                        /* Modal Right Section (GIF) */
                        .modal-right {
                            flex: 1;
                            background-color: #1a1a1a;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        }

                        .marketing-gif {
                            max-width: 100%;
                            max-height: 100%;
                            border-radius: 10px;
                        }

                        /* Loading Overlay */
                        .loading-overlay {
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background-color: rgba(0, 0, 0, 0.7);
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: center;
                            z-index: 9999;
                        }

                        .loading-spinner {
                            border: 4px solid #f3f3f3;
                            border-top: 4px solid #ffd60a;
                            border-radius: 50%;
                            width: 40px;
                            height: 40px;
                            animation: spin 1s linear infinite;
                        }

                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }

                        /* Responsive Styles */
                        @media (max-width: 992px) {
                            .modal-content {
                                flex-direction: column;
                                height: 80%;
                            }

                            .modal-left,
                            .modal-right {
                                height: 50%;
                            }
                        }
                        </style>

                    </div>



                   </div>

                </div>
            

            </div>

            <div class="gap" style="height: 30px;"></div>
           
            <div class="column website">
                <div class="video-item" style="width: 200px;">
                    <img id="resume-video" src="{% static 'folder/hello.gif' %}" alt="GIF coming soon">
                </div>
            </div>

            <div class="gap" style="height: 30px;"></div>
        
            <a href="#pricing" style="text-decoration: none;">
                <div class="column website">
                    <h3 style="color: #ff6347; margin-top: 20px;">Upgrade your plan</h3>
                </div>
            </a>
            
        
            
        </div>

        <div class="right-section">
            <!-- Resume Column (Right) -->
            <div class="resume-container">
                <!-- Dynamic Google Doc Link Heading -->
                
        
                <script>
                    // Function to update the iframe and the Google Doc link
                    function updateResumeIframe(select) {
                        var selectedLink = select.value;
                        var iframe = document.getElementById('resumeIframe');
                        var googleDocAnchor = document.getElementById('googleDocAnchor');
        
                        // Update the iframe source and the link in the heading
                        iframe.src = selectedLink;
                        googleDocAnchor.href = selectedLink;
                    }
        
                    window.onload = function () {
                        var lastLink = '{{ account.get_resume_links|last }}';
                        var iframe = document.getElementById('resumeIframe');
                        var googleDocAnchor = document.getElementById('googleDocAnchor');
        
                        // Load the latest resume by default
                        iframe.src = lastLink;
                        googleDocAnchor.href = lastLink;
                    };
                </script>
        
                
        
                <!-- Dropdown for Resume Selection -->
                {% if account.get_resume_links %}
                <select id="resumeDropdown" onchange="updateResumeIframe(this)">
                    {% for link in account.get_resume_links %}
                    <option value="{{ link }}" {% if forloop.last %}selected{% endif %}>
                        {{ 'Resume ' }}{{ forloop.counter }}
                    </option>
                    {% endfor %}
                </select>
                {% else %}
                <p>No resume links available.</p>
                {% endif %}
        
                <!-- Embed Resume Iframe -->
                <div class="resume-embed">
                    <iframe id="resumeIframe" class="resumeIframe" allowfullscreen></iframe>
                </div>
            </div>
        </div>
        
        <style>
            /* Style for loading screen */
            .loading-message {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: #ffd60a;
                color: white;
                font-size: 1.5rem;
                padding: 20px;
                border-radius: 5px;
                display: none; /* Hidden by default */
                z-index: 10; /* Ensures the loading message is on top of the iframe */
            }
        
            /* Make sure the iframe is positioned correctly */
            .resume-embed {
                position: relative; /* This makes the loading message position relative to the iframe container */
            }
        
            /* Optional: Add a loading animation if you want */
            .loading-message p {
                margin: 0;
                animation: fadeIn 2s infinite;
            }
        
            @keyframes fadeIn {
                0% { opacity: 0; }
                50% { opacity: 1; }
                100% { opacity: 0; }
            }
        </style>

</section>

<div class="interviews-by" style="margin-top: -400px;">
    <img src="{% static 'img/D861DC30-268C-46DC-8AB5-24805709194F.png' %}" alt="interviews-by.png" style="width: 100%; height: auto;">
</div>

<!-- Pricing Section -->

<form method="post" action="{% url 'confirmation' account_id=account.id %}">
{% csrf_token %}
<section id="pricing" name="pricing" style="background-color: #1c1c1c; padding: 0px; border-radius: 12px; color: #e0e0e0; max-width: 1100px; margin: auto;">
    <h2 style="text-align: center; font-size: 2.5em; color: #ffd60a; margin-bottom: 40px; font-family: 'Poppins', sans-serif;">Pricing</h2>
    <p style="text-align: center; color: #a9a9a9; font-size: 1.1em; margin-bottom: 30px;">All resumes are optimized for Applicant Tracking Systems (ATS)</p>

    <div style="display: flex; flex-wrap: wrap; justify-content: space-between; gap: 15px;">
        
        <!-- Pricing Card Template -->
        <!-- Free Plan -->
        <div style="flex: 1 1 175px; background-color: #292929; padding: 20px; border-radius: 10px; text-align: center; max-width: 350px;">
            <h3 style="color: #ffd60a; font-size: 1.3em; margin-bottom: 8px;">Free</h3>
            <p style="font-size: 1.2em; font-weight: bold;">$0.00</p>
            <ul style="list-style-type: none; padding: 0; font-size: 0.9em; color: #b0b0b0;">
                <li>‚úì 2 builds <span style="color: #ffd60a;">What are builds?</span></li>
                <li>‚úì Tailored resume</li>
                <li>‚úì Tailored cover letter</li>
                <li>‚ö† Personal website (1 day)</li>
                <li>‚ö† Bullets for 1 experience/project</li>
                <li style="color: #ff6347; margin-top: 8px;">
                    {% if account.tier == 'free' %}
                                    Current
                                {% else %}
                                    Free version expired 
                                {% endif %}
                </li>
            </ul>
        </div>

        <!-- Basic Plan -->
        <div style="flex: 1 1 175px; background-color: #292929; padding: 20px; border-radius: 10px; text-align: center; max-width: 350px;">
            <h3 style="color: #ffd60a; font-size: 1.3em; margin-bottom: 8px;">Basic</h3>
            <p style="font-size: 1.2em; font-weight: bold;">$9.99</p>
            <ul style="list-style-type: none; padding: 0; font-size: 0.9em; color: #b0b0b0;">
                <li>‚úì 20 builds</li>
                <li>‚úì Tailored resume</li>
                <li>‚úì Tailored cover letter</li>
                <li>‚ö† Personal website (6 months)</li>
                <li>‚úì All bullets AI generated</li>
            </ul>
            
            <button class="button" name="selected_plan" value="basic" style="display: inline-block; background-color: #ffd60a; color: #1c1c1c; padding: 8px 16px; border-radius: 6px; font-weight: bold; margin-top: 8px;">
                {% if account.tier == 'basic' %}
                Current
                {% else %}
                Buy Now
                {% endif %}
            </button>

        </div>

        <!-- Economy Plan -->
        <div style="flex: 1 1 175px; background-color: #292929; padding: 20px; border-radius: 10px; text-align: center; max-width: 350px;">
            <h3 style="color: #ffd60a; font-size: 1.3em; margin-bottom: 8px;">Economy</h3>
            <p style="font-size: 1.2em; font-weight: bold;">$19.99</p>
            <ul style="list-style-type: none; padding: 0; font-size: 0.9em; color: #b0b0b0;">
                <li>‚úì 50 builds</li>
                <li>‚úì Tailored resume</li>
                <li>‚úì Tailored cover letter</li>
                <li>‚ö† Personal website (1 year)</li>
                <li>‚úì All bullets AI generated</li>
            </ul>

            <button class="button" name="selected_plan" value="economy" style="display: inline-block; background-color: #ffd60a; color: #1c1c1c; padding: 8px 16px; border-radius: 6px; font-weight: bold; margin-top: 8px;">
                {% if account.tier == 'economy' %}
                Current
                {% else %}
                Buy Now
                {% endif %}
            </button>

        </div>

        <!-- Business Plan (Recommended) -->
        <div style="position: relative; flex: 1 1 175px; background-color: #292929; padding: 20px; border-radius: 10px; text-align: center; max-width: 350px;">
            <!-- Ribbon for Recommended -->
            <div style="position: absolute; top: -10px; left: -10px; background-color: #e73131; color: #1c1c1c; font-weight: bold; padding: 4px 30px; font-size: 0.8em; border-top-right-radius: 8px; border-bottom-right-radius: 8px;">
                Recommended
            </div>

            <h3 style="color: #ffd60a; font-size: 1.3em; margin-bottom: 8px;">Business</h3>
            <p style="font-size: 1.2em; font-weight: bold;">$39.99</p>
            
            <ul style="list-style-type: none; padding: 0; font-size: 0.9em; color: #b0b0b0;">
                <li>‚úì 100 builds</li>
                <li>‚úì Tailored resume</li>
                <li>‚úì Tailored cover letter</li>
                <li>‚úì Personal website forever</li>
                <li>‚úì All bullets AI generated</li>
            </ul>


            <button class="button" name="selected_plan" value="business" style="display: inline-block; background-color: #ffd60a; color: #1c1c1c; padding: 8px 16px; border-radius: 6px; font-weight: bold; margin-top: 8px;">
                {% if account.tier == 'business' %}
                Current
                {% else %}
                Buy Now
                {% endif %}
            </button>

        </div>


        <!-- First Class Plan -->
        <div style="flex: 1 1 175px; background-color: #292929; padding: 20px; border-radius: 10px; text-align: center; max-width: 350px;">
            <h3 style="color: #ffd60a; font-size: 1.3em; margin-bottom: 8px;">First Class</h3>
            <p style="font-size: 1.2em; font-weight: bold;">$59.99</p>
            <ul style="list-style-type: none; padding: 0; font-size: 0.9em; color: #b0b0b0;">
                <li>‚úì 200 builds</li>
                <li>‚úì Tailored resume</li>
                <li>‚úì Tailored cover letter</li>
                <li>‚úì Personal website forever</li>
                <li>‚úì All bullets AI generated</li>
            </ul>

            <button class="button" name="selected_plan" value="first_class" style="display: inline-block; background-color: #ffd60a; color: #1c1c1c; padding: 8px 16px; border-radius: 6px; font-weight: bold; margin-top: 8px;">
                {% if account.tier == 'first_class' %}
                Current
                {% else %}
                Buy Now
                {% endif %}
            </button>

        </div>
        
        <!-- Pilot Plan -->
        <div style="flex: 1 1 175px; background-color: #292929; padding: 20px; border-radius: 10px; text-align: center; max-width: 350px;">
            <h3 style="color: #ffd60a; font-size: 1.3em; margin-bottom: 8px;">Pilot</h3>
            <p style="font-size: 1.2em; font-weight: bold;">$99.99</p>
            <ul style="list-style-type: none; padding: 0; font-size: 0.9em; color: #b0b0b0;">
                <li>‚úì 400 builds</li>
                <li>‚úì Tailored resume</li>
                <li>‚úì Tailored cover letter</li>
                <li>‚úì Personal website forever</li>
                <li>‚úì All bullets AI generated</li>
            </ul>

            <button class="button" name="selected_plan" value="pilot" style="display: inline-block; background-color: #ffd60a; color: #1c1c1c; padding: 8px 16px; border-radius: 6px; font-weight: bold; margin-top: 8px;">
                {% if account.tier == 'pilot' %}
                Current
                {% else %}
                Buy Now
                {% endif %}
            </button>

        </div>
        
        <!-- Pilot 2 Plan -->
        <div style="flex: 1 1 175px; background-color: #292929; padding: 20px; border-radius: 10px; text-align: center; max-width: 350px;">
            <h3 style="color: #ffd60a; font-size: 1.3em; margin-bottom: 8px;">Pilot 2</h3>
            <p style="font-size: 1.2em; font-weight: bold;">$199.99</p>
            <ul style="list-style-type: none; padding: 0; font-size: 0.9em; color: #b0b0b0;">
                <li>‚úì 1000 builds</li>
                <li>‚úì Tailored resume</li>
                <li>‚úì Tailored cover letter</li>
                <li>‚úì Personal website forever</li>
                <li>‚úì All bullets AI generated</li>
            </ul>

            <button class="button" name="selected_plan" value="pilot2" style="display: inline-block; background-color: #ffd60a; color: #1c1c1c; padding: 8px 16px; border-radius: 6px; font-weight: bold; margin-top: 8px;">
                {% if account.tier == 'pilot2' %}
                Current
                {% else %}
                Buy Now
                {% endif %}
            </button>

        </div>
        
        <!-- Custom Plan -->
        <div style="flex: 1 1 175px; background-color: #292929; padding: 20px; border-radius: 10px; text-align: center; max-width: 350px;">
            <h3 style="color: #ffd60a; font-size: 1.3em; margin-bottom: 8px;">Custom</h3>
            <p style="font-size: 1.2em; font-weight: bold;">$custom</p>
            <ul style="list-style-type: none; padding: 0; font-size: 0.9em; color: #b0b0b0;">
                <li>‚úì Custom builds</li>
                <li>‚úì Tailored resume</li>
                <li>‚úì Tailored cover letter</li>
                <li>‚úì Personal website forever</li>
                <li>‚úì All bullets AI generated</li>
            </ul>
            <a href="#" class="button" style="display: inline-block; background-color: #ffd60a; color: #1c1c1c; padding: 8px 16px; border-radius: 6px; font-weight: bold; margin-top: 8px;">Contact Us</a>
        </div>
        
    </div>
</section>
</form>


<script>
    function edit_data_redirect_pricing() {
        alert("Your verison has ended, please upgrade plan");
        var accountId = "{{ account.id }}"; // Make sure account.id is properly rendered
        var redirectDomain = "{{ redirect_domain }}";
        var confirmationUrl = redirectDomain + '' + accountId + '/confirmation#pricing';
        window.location.href = confirmationUrl;

    }
</script>



</section>

</html>

{% endblock %}
